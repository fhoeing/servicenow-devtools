<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_snc_devtools.GetFlowStructureTree</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Returns the structure of a flow or subflow outlining the contained SubFlows (and their SubFlows) in a structured object or false of the given Flow or SubFlow could not be found.</description>
        <mobile_callable>false</mobile_callable>
        <name>GetFlowStructureTree</name>
        <sandbox_callable>false</sandbox_callable>
        <script><![CDATA[function GetFlowStructureTree(vFlow,nMaxLevel,nLevel)
{
	var grFlow = GetRecord('sys_hub_flow',vFlow);
	if (IsValidRecord(grFlow) == false)
	{
		return false;
	}
	var flow = Clone(grFlow);

	var strFlowType = '';
	if (flow.type == 'flow')
	{
		strFlowType += ' (Flow)';
	}
	nMaxLevel = GetIntegerValue(nMaxLevel);
	nLevel = GetIntegerValue(nLevel);

	var strContent = '<b>' + flow.name + strFlowType + '</b><br/>';
	var strUrl = GetRecordPath('sys_hub_flow',flow.sys_id);

	strContent += HtmlRenderLink(strUrl,'Workflow Studio',true) + ' ';

	flow.content = strContent;
	flow._nodes = [];

	var bSubFlows = true;
	if (nMaxLevel > 0)
	{
		if (nLevel >= nMaxLevel)
		{
			bSubFlows = false;
		}
	}

	if (bSubFlows == true)
	{

		var aSubFlowInstances = [];

		var grFlowInstance = new GlideRecord('sys_hub_sub_flow_instance_v2');
		grFlowInstance.addQuery('flow','=',grFlow.sys_id);
		grFlowInstance.orderBy('order');
		grFlowInstance.query();
		while (grFlowInstance.next())
		{
			var subflowinstance = Clone(grFlowInstance);
			subflowinstance.order = GetIntegerValue(subflowinstance.order);
			aSubFlowInstances.push(subflowinstance);
		}
		
		function CompareOrder(a,b)
		{
			return a.order - b.order;
		}
		aSubFlowInstances = aSubFlowInstances.sort(CompareOrder);

		for (var nSubFlowInstance = 0; nSubFlowInstance < aSubFlowInstances.length; nSubFlowInstance++)
		{
			var subflowinstance = aSubFlowInstances[nSubFlowInstance];
			var grFlowSnapshot = GetRecord('sys_hub_flow_snapshot',subflowinstance.subflow);
			if (IsValidRecord(grFlowSnapshot) == true)
			{
				var subflow = GetFlowStructureTree(
					grFlowSnapshot.parent_flow,
					nMaxLevel,
					nLevel+1);
				if (subflow != false)
				{
					flow._nodes.push(subflow);
				}
			}
		}
	}

	return flow;
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-18 15:33:16</sys_created_on>
        <sys_id>6ef4a6f53b04fe1062bf612c95e45a5c</sys_id>
        <sys_mod_count>25</sys_mod_count>
        <sys_name>GetFlowStructureTree</sys_name>
        <sys_package display_value="DevTools" source="x_snc_devtools">d689f6901bd38450a89720a8ec4bcbfd</sys_package>
        <sys_policy/>
        <sys_scope display_value="DevTools">d689f6901bd38450a89720a8ec4bcbfd</sys_scope>
        <sys_update_name>sys_script_include_6ef4a6f53b04fe1062bf612c95e45a5c</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-10 13:32:12</sys_updated_on>
        <x_snc_devtools_sys_ui_script/>
    </sys_script_include>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>6ef4a6f53b04fe1062bf612c95e45a5c</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-18 15:33:16</sys_created_on>
        <sys_id>9f65eef53b04fe1062bf612c95e45aa0</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-18 15:33:16</sys_updated_on>
        <table>sys_script_include</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
